<UserControl x:Class="C_TestForge.UI.Controls.DefinitionsAnalysisControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    
    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Header with Title and Actions -->
        <materialDesign:Card Grid.Row="0" Margin="0,0,0,12" UniformCornerRadius="8"
                           materialDesign:ShadowAssist.ShadowDepth="Depth1">
            <Grid Margin="20,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Pound" 
                                           Foreground="{StaticResource AccentColor}" 
                                           VerticalAlignment="Center" Margin="0,0,12,0" Width="24" Height="24"/>
                    <StackPanel>
                        <TextBlock Text="Definitions &amp; Macros" Style="{StaticResource HeadingStyle}" Margin="0,0,0,4"/>
                        <TextBlock Text="{Binding Definitions.Count, StringFormat='Total: {0} definitions found'}" 
                                 Style="{StaticResource SubheadingStyle}"/>
                    </StackPanel>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="Export to CSV" Style="{StaticResource OutlinedButtonStyle}"
                          Command="{Binding ExportDefinitionsCommand}" 
                          Margin="0,0,8,0">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="FileExport" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding}"/>
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>
                    <Button Content="Refresh" Style="{StaticResource SecondaryButtonStyle}"
                          Command="{Binding RefreshDefinitionsCommand}">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Refresh" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding}"/>
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>
                </StackPanel>
            </Grid>
        </materialDesign:Card>
        
        <!-- Filter and Search -->
        <materialDesign:Card Grid.Row="1" Margin="0,0,0,12" UniformCornerRadius="8"
                           materialDesign:ShadowAssist.ShadowDepth="Depth1">
            <Grid Margin="16,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Search Box -->
                <TextBox Grid.Column="0" 
                       Style="{StaticResource MaterialDesignOutlinedTextBox}"
                       materialDesign:HintAssist.Hint="Search definitions by name or value..."
                       Text="{Binding DefinitionSearchText, UpdateSourceTrigger=PropertyChanged}"
                       Margin="0,0,12,0">
                    <TextBox.InputBindings>
                        <KeyBinding Key="Enter" Command="{Binding SearchDefinitionsCommand}"/>
                    </TextBox.InputBindings>
                </TextBox>
                
                <!-- Filter Toggles -->
                <ToggleButton Grid.Column="1" Content="Function-like" 
                            Style="{StaticResource MaterialDesignFlatPrimaryToggleButton}"
                            IsChecked="{Binding ShowFunctionLikeMacros}"
                            Margin="0,0,8,0" Padding="8,4"/>
                
                <ToggleButton Grid.Column="2" Content="Enabled Only" 
                            Style="{StaticResource MaterialDesignFlatPrimaryToggleButton}"
                            IsChecked="{Binding ShowEnabledOnly}"
                            Margin="0,0,8,0" Padding="8,4"/>
                
                <Button Grid.Column="3" Content="Clear" 
                      Style="{StaticResource TextButtonStyle}"
                      Command="{Binding ClearDefinitionFiltersCommand}"/>
            </Grid>
        </materialDesign:Card>
        
        <!-- Definitions DataGrid -->
        <materialDesign:Card Grid.Row="2" UniformCornerRadius="8"
                           materialDesign:ShadowAssist.ShadowDepth="Depth1">
            <DataGrid ItemsSource="{Binding FilteredDefinitions}" 
                    Style="{StaticResource ModernDataGridStyle}"
                    materialDesign:DataGridAssist.ColumnHeaderPadding="8,4" 
                    Margin="8" CanUserAddRows="False" CanUserDeleteRows="False">
                <DataGrid.Columns>
                    <!-- Name Column with Icon -->
                    <DataGridTemplateColumn Header="Name" Width="200" 
                                          materialDesign:DataGridAssist.ColumnHeaderPadding="8,4">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="{Binding IsFunctionLike, Converter={StaticResource BoolToIconConverter}, ConverterParameter='Function,Pound'}" 
                                                           Width="16" Height="16" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding Name}" VerticalAlignment="Center" FontWeight="Medium"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- Value Column with Truncation -->
                    <DataGridTemplateColumn Header="Value" Width="*" 
                                          materialDesign:DataGridAssist.ColumnHeaderPadding="8,4">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Value}" 
                                         TextTrimming="CharacterEllipsis"
                                         ToolTip="{Binding Value}"
                                         VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- Type with Color Coding -->
                    <DataGridTemplateColumn Header="Type" Width="120" 
                                          materialDesign:DataGridAssist.ColumnHeaderPadding="8,4">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Background="{Binding DefinitionType, Converter={StaticResource TypeToColorConverter}}" 
                                      CornerRadius="12" Padding="8,2" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding DefinitionType}" 
                                             Foreground="White" FontSize="10" FontWeight="Medium"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- Line Number -->
                    <DataGridTextColumn Header="Line" Binding="{Binding LineNumber}" Width="60"
                                      materialDesign:DataGridAssist.ColumnHeaderPadding="8,4">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="FontFamily" Value="{StaticResource CodeFont}"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <!-- Function-like Indicator -->
                    <DataGridCheckBoxColumn Header="Function-like" Binding="{Binding IsFunctionLike}" Width="100"
                                          materialDesign:DataGridAssist.ColumnHeaderPadding="8,4" IsReadOnly="True"/>
                    
                    <!-- Enabled Status -->
                    <DataGridCheckBoxColumn Header="Enabled" Binding="{Binding IsEnabled}" Width="80"
                                          materialDesign:DataGridAssist.ColumnHeaderPadding="8,4" IsReadOnly="True"/>
                    
                    <!-- Source File -->
                    <DataGridTextColumn Header="Source File" Binding="{Binding SourceFile}" Width="200"
                                      materialDesign:DataGridAssist.ColumnHeaderPadding="8,4">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                <Setter Property="ToolTip" Value="{Binding SourceFile}"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
                
                <!-- Row Style with Hover Effects -->
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow" BasedOn="{StaticResource {x:Type DataGridRow}}">
                        <Setter Property="Height" Value="40"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource AccentColorLight}"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>
            </DataGrid>
        </materialDesign:Card>
    </Grid>
</UserControl>