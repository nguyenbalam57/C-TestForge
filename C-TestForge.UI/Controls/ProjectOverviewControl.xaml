<UserControl x:Class="C_TestForge.UI.Controls.ProjectOverviewControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    
    <ScrollViewer>
        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Project Statistics Card -->
            <materialDesign:Card Grid.Row="0" Margin="0,0,0,16" UniformCornerRadius="8"
                               materialDesign:ShadowAssist.ShadowDepth="Depth1">
                <Grid Margin="20,16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Title -->
                    <TextBlock Grid.Row="0" Text="Project Statistics" 
                             Style="{StaticResource HeadingStyle}" Margin="0,0,0,16"/>
                    
                    <!-- Statistics Grid -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Total Files" Style="{StaticResource SubheadingStyle}" Margin="0,0,0,4"/>
                            <TextBlock Text="{Binding ProjectAnalysisResult.ProcessedFileCount}" 
                                     Style="{StaticResource StatisticValueStyle}"/>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1">
                            <TextBlock Text="Functions Found" Style="{StaticResource SubheadingStyle}" Margin="0,0,0,4"/>
                            <TextBlock Text="{Binding ProjectAnalysisResult.Functions.Count}" 
                                     Style="{StaticResource StatisticValueStyle}"/>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Variables Found" Style="{StaticResource SubheadingStyle}" Margin="0,0,0,4"/>
                            <TextBlock Text="{Binding ProjectAnalysisResult.Variables.Count}" 
                                     Style="{StaticResource StatisticValueStyle}"/>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="3">
                            <TextBlock Text="Macros Found" Style="{StaticResource SubheadingStyle}" Margin="0,0,0,4"/>
                            <TextBlock Text="{Binding ProjectAnalysisResult.Macros.Count}" 
                                     Style="{StaticResource StatisticValueStyle}"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </materialDesign:Card>
            
            <!-- File Distribution Card -->
            <materialDesign:Card Grid.Row="1" Margin="0,0,0,16" UniformCornerRadius="8"
                               materialDesign:ShadowAssist.ShadowDepth="Depth1">
                <StackPanel Margin="20,16">
                    <TextBlock Text="File Distribution" Style="{StaticResource HeadingStyle}" Margin="0,0,0,12"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0" Margin="0,0,12,0">
                            <TextBlock Text="{Binding HeaderFilesCount, StringFormat='Header Files: {0}'}" 
                                     Style="{StaticResource BodyTextStyle}" Margin="0,0,0,4"/>
                            <TextBlock Text="{Binding SourceFilesCount, StringFormat='Source Files: {0}'}" 
                                     Style="{StaticResource BodyTextStyle}"/>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1">
                            <TextBlock Text="{Binding ProjectAnalysisResult.CompletionPercentage, StringFormat='Completion: {0:F1}%'}" 
                                     Style="{StaticResource BodyTextStyle}" Margin="0,0,0,4"/>
                            <ProgressBar Value="{Binding ProjectAnalysisResult.CompletionPercentage}" 
                                       Maximum="100" Height="6" 
                                       Background="{StaticResource BorderLight}"
                                       Foreground="{StaticResource AccentColor}"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </materialDesign:Card>
            
            <!-- Analysis Errors Card (if any) -->
            <materialDesign:Card Grid.Row="2" Margin="0,0,0,16" UniformCornerRadius="8"
                               materialDesign:ShadowAssist.ShadowDepth="Depth1"
                               Visibility="{Binding ProjectAnalysisResult.HasErrors, Converter={StaticResource BooleanToVisibilityConverter}}">
                <StackPanel Margin="20,16">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <materialDesign:PackIcon Kind="AlertCircle" 
                                               Foreground="{StaticResource ErrorColor}" 
                                               VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="Analysis Errors" Style="{StaticResource HeadingStyle}" 
                                 Foreground="{StaticResource ErrorColor}"/>
                    </StackPanel>
                    
                    <ItemsControl ItemsSource="{Binding ProjectAnalysisResult.Errors}" MaxHeight="150">
                        <ItemsControl.Template>
                            <ControlTemplate>
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ItemsPresenter/>
                                </ScrollViewer>
                            </ControlTemplate>
                        </ItemsControl.Template>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource ErrorColor}" 
                                      CornerRadius="4" Padding="8,4" Margin="0,2"
                                      Opacity="0.1">
                                    <TextBlock Text="{Binding}" Style="{StaticResource BodyTextStyle}" 
                                             Foreground="{StaticResource ErrorColor}"
                                             TextWrapping="Wrap"/>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </materialDesign:Card>
            
            <!-- Processed Files Card -->
            <materialDesign:Card Grid.Row="3" UniformCornerRadius="8"
                               materialDesign:ShadowAssist.ShadowDepth="Depth1">
                <StackPanel Margin="20,16">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <materialDesign:PackIcon Kind="FileMultiple" 
                                               Foreground="{StaticResource AccentColor}" 
                                               VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="Processed Files" Style="{StaticResource HeadingStyle}"/>
                        <TextBlock Text="{Binding ProjectAnalysisResult.ProcessedFiles.Count, StringFormat='({0} files)'}" 
                                 Style="{StaticResource SubheadingStyle}" 
                                 VerticalAlignment="Bottom" Margin="8,0,0,2"/>
                    </StackPanel>
                    
                    <DataGrid ItemsSource="{Binding ProjectAnalysisResult.ProcessedFiles}" 
                            Style="{StaticResource ModernDataGridStyle}" 
                            MaxHeight="300" MinHeight="150">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="File Path" Binding="{Binding}" Width="*">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="ToolTip" Value="{Binding}"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </materialDesign:Card>
        </Grid>
    </ScrollViewer>
</UserControl>